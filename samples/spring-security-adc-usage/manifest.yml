---
# Configuration:
# configured for EU10. For other landscapes, please adopt LANDSCAPE_APPS_DOMAIN in ../vars.yml
# If the route is occupied, you might need to change ID in ../vars.yml
applications:
# The sample application.
- name: spring-security-adc-usage
  instances: 1
  memory: 896M
  routes:
    - route: spring-security-adc-usage-((ID)).((LANDSCAPE_APPS_DOMAIN))
  path: target/spring-security-adc-usage.jar
  services:
    - xsuaa-adc
  env:
    OPA_ADDR: https://adc-service-((ID)).((LANDSCAPE_APPS_DOMAIN))
# Application Router as web server
- name: approuter-spring-security-adc-usage
  path: approuter
  buildpacks:
    - nodejs_buildpack
  memory: 128M
  routes:
    - route: spring-security-adc-usage-web-((ID)).((LANDSCAPE_APPS_DOMAIN))
  services:
    - xsuaa-adc
  env:
    destinations: >
      [
        {"name":"token-destination",
         "url":"https://spring-security-adc-usage-((ID)).((LANDSCAPE_APPS_DOMAIN))",
         "forwardAuthToken": true}
      ]
# Authorization Decision Controller service
- name: adc-service
  path: adc/rbac
  memory: 512M
  routes:
    - route: adc-service-((ID)).((LANDSCAPE_APPS_DOMAIN))
  buildpacks:
    - https://github.com/saescha/opa-builpack-PoC.git
  # directly uploads bundle
  command: ./opa run -s -c OPAConfig --log-level=debug --addr=[]:$PORT rbac.rego data.json
...
